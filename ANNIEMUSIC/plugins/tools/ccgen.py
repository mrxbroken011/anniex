from pyrogram import Client, filters
from pyrogram.types import Message
from ANNIEMUSIC import app 
# Assuming 'api' is some external module you're using for ccgen functionality
# from some_module import api

@app.on_message(filters.command(["gen", "ccgen"], [".", "!", "/"]))
async def gen_cc(client: Client, message: Message):
    # Check if the user provided a BIN
    if len(message.command) < 2:
        await message.reply_text("âš ï¸ Please provide a BIN to generate CC.")
        return
    
    # Try to delete the user's command message
    try:
        await message.delete()
    except Exception as delete_error:
        print(f"Failed to delete the message: {delete_error}")

    aux = await message.reply_text("âœ… Generating...")

    # Extract the BIN from the message
    bin_input = message.text.split(None, 1)[1]

    # Validate BIN length
    if len(bin_input) < 6:
        await aux.edit("ðŸš« Invalid BIN. Please provide at least the first 6 digits.")
        return

    try:
        # Generate credit cards
        resp = await api.ccgen(bin_input, 10)
        cards = resp['liveCC']
        name = message.from_user.first_name
        time_taken = resp['took']
        bin_info = resp['results'][0]['bin']

        # Prepare the message to be sent
        response_text = f"""
â… âœ§ ð—•ð—¥ð—¢ð—žð—˜ð—¡ ð—« ð—–ð—– ð—šð—˜ð—¡ð—˜ð—¥ð—”ð—§ð—¢ð—¥ âœ§ â…

`{cards[0]}`\n`{cards[1]}`\n`{cards[2]}`
`{cards[3]}`\n`{cards[4]}`\n`{cards[5]}`
`{cards[6]}`\n`{cards[7]}`\n`{cards[8]}`
`{cards[9]}`

**-----------------------------**

**ðŸªª Generated By:** {name}

**ðŸ’³ BIN:** `{bin_input}`
**ðŸªª Dev:** [ã€Žð™¼ðšã€ã€†ð”…ð”¯ð”¬ð”¨ð”¢ð”«](https://t.me/AboutBrokenx)
**â³ Time Taken:** `{time_taken}`
ð—•ð—¶ð—» ð—Ÿð—¼ð—¼ð—¸ð˜‚ð—½ ð—¥ð—²ð˜€ð˜‚ð—¹ð˜ ðŸ”
**ðŸ”ŽINFO :** `{bin_info}`\n\n"""
        
        await aux.edit(response_text)

    except Exception as e:
        print(f"Error during card generation: {e}")
        await aux.edit(f"**Error:** `{e}`")

